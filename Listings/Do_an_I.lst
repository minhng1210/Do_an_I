C51 COMPILER V9.60.7.0   DO_AN_I                                                           06/12/2025 19:42:24 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DO_AN_I
OBJECT MODULE PLACED IN .\Objects\Do_an_I.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Do_an_I.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\D
                    -o_an_I.lst) TABS(2) OBJECT(.\Objects\Do_an_I.obj)

line level    source

   1          #include <REGX51.H>
   2          #include <Do_an_I_LCD.H>
   3          #include <Do_an_I_DS1307.H>
   4          
   5          sbit PIR1 = P1^0;
   6          sbit PIR2 = P1^1;
   7          
   8          sbit ON = P1^4;
   9          sbit OFF = P1^5;
  10          sbit SET = P1^6;
  11          sbit ADJUST = P1^7;
  12          
  13          sbit LAMP1 = P2^0;
  14          sbit LAMP2 = P2^1;
  15          sbit LAMP3 = P2^2;
  16          
  17          unsigned int hour, minute, second, day, date, month, year;
  18          
  19          void Delay(unsigned int t){
  20   1          unsigned int i, j;
  21   1          for (i = 0; i < t; i++)
  22   1              for (j = 0; j < 123; j++);
  23   1      }
  24          
  25          void Display_Time(){
  26   1        LCD_Gotoxy(4,0);
  27   1        LCD_PutNumber(hour/10);
  28   1        LCD_PutNumber(hour%10);
  29   1        LCD_Puts(":");
  30   1        LCD_PutNumber(minute/10);
  31   1        LCD_PutNumber(minute%10);
  32   1        LCD_Puts(":");
  33   1        LCD_PutNumber(second/10);
  34   1        LCD_PutNumber(second%10);
  35   1        LCD_Gotoxy(1,1);
  36   1        if(day <= 1){
  37   2          LCD_Puts("CN ");
  38   2        }else{
  39   2        LCD_Puts("T");
  40   2        LCD_PutNumber(day);
  41   2        LCD_Puts(" ");
  42   2        }
  43   1        LCD_PutNumber(date/10);
  44   1        LCD_PutNumber(date%10);
  45   1        LCD_Puts("/");
  46   1        LCD_PutNumber(month/10);
  47   1        LCD_PutNumber(month%10);
  48   1        LCD_Puts("/");
  49   1        LCD_PutNumber(2);
  50   1        LCD_PutNumber(0);
  51   1        LCD_PutNumber(year/10);
  52   1        LCD_PutNumber(year%10);
  53   1      }
  54          void Flicker(unsigned int num, unsigned char x, unsigned char y){
C51 COMPILER V9.60.7.0   DO_AN_I                                                           06/12/2025 19:42:24 PAGE 2   

  55   1        LCD_Gotoxy(x, y);
  56   1        LCD_Puts(" ");
  57   1        Delay(100);
  58   1        LCD_Gotoxy(x, y);
  59   1        LCD_PutNumber(num);
  60   1        Delay(100);
  61   1      }
  62          void Adjust_Time(unsigned int *time, unsigned char x, unsigned char y,  unsigned int max){
  63   1        unsigned int dozens = *time/10;
  64   1        unsigned int unit = *time%10;
  65   1        while (ADJUST){
  66   2          Flicker(dozens, x, y);
  67   2          if (!SET) break;
  68   2        }
  69   1        while(SET){
  70   2          if (ADJUST == 0){
  71   3          dozens += 1;
  72   3          }
  73   2          if (dozens > max/10){
  74   3            dozens = 0;
  75   3          }
  76   2          Flicker(dozens, x, y);
  77   2        }
  78   1        Delay(200);
  79   1        while(SET){
  80   2          if (dozens*10 + unit > max || unit > 9){
  81   3            unit = 0;
  82   3          }
  83   2          if (ADJUST == 0){
  84   3          unit += 1;
  85   3          }
  86   2          Flicker(unit, x+1, y);  
  87   2        }
  88   1        *time = dozens*10 + unit;
  89   1      }
  90          void Adjust_Time_Day(){
  91   1        while (ADJUST){
  92   2          LCD_Gotoxy(1, 1);
  93   2          LCD_Puts("  ");
  94   2          Delay(200);
  95   2          LCD_Gotoxy(1, 1);
  96   2          if(day <= 1){
  97   3            LCD_Puts("CN ");
  98   3          }else{
  99   3            LCD_Puts("T");
 100   3            LCD_PutNumber(day);
 101   3          }
 102   2          Delay(200);
 103   2          if (!SET) break;
 104   2        }
 105   1        while(SET){
 106   2          if (ADJUST == 0){
 107   3          day += 1;
 108   3          }
 109   2          if (day > 7){
 110   3            day = 1;
 111   3          }
 112   2          LCD_Gotoxy(1, 1);
 113   2          LCD_Puts("  ");
 114   2          Delay(200);
 115   2          LCD_Gotoxy(1, 1);
 116   2          if(day <= 1){
C51 COMPILER V9.60.7.0   DO_AN_I                                                           06/12/2025 19:42:24 PAGE 3   

 117   3            LCD_Puts("CN ");
 118   3          }else{
 119   3            LCD_Puts("T");
 120   3            LCD_PutNumber(day);
 121   3          }
 122   2          Delay(200);
 123   2        }
 124   1      }
 125          void Set_Time(){
 126   1        int max;
 127   1        Adjust_Time(&hour, 4, 0, 23);
 128   1        Adjust_Time(&minute, 7, 0, 60);
 129   1        Adjust_Time(&second, 10, 0, 60);
 130   1        Adjust_Time_Day();
 131   1        Adjust_Time(&date, 4, 1, 31);
 132   1        Adjust_Time(&month, 7, 1, 12);
 133   1        Adjust_Time(&year, 12, 1, 99);
 134   1        switch (month) {
 135   2          case 4: case 6: case 9: case 11:
 136   2            max = 30;
 137   2            break;
 138   2          case 2:
 139   2            if ((year % 4 == 0 && year % 100 != 0) || (year % 400 == 0)){
 140   3              max = 29;
 141   3            }else{
 142   3              max = 28;
 143   3            }
 144   2            break;
 145   2          default:
 146   2            max = 31;
 147   2        }
 148   1        if (date > max){
 149   2          date = max;
 150   2        }
 151   1        DS1307_Write_Time(hour, minute, second, day, date, month, year);
 152   1      }
 153          
 154          void Delay_Lamp(){
 155   1        int m, n;
 156   1        for (m = 0; m < 40; m++){
 157   2          for (n = 0; n < 12500; n++);
 158   2          DS1307_Read_Time(&hour, &minute, &second, &day, &date, &month, &year);
 159   2          Display_Time();
 160   2          if (!ON || !OFF){
 161   3            break;
 162   3          }
 163   2        }
 164   1      }
 165          
 166          void main() {
 167   1        int m, n;
 168   1        int l2 = 0;
 169   1        DS1307_Init();
 170   1        LCD_Init();
 171   1        LAMP1 = LAMP2 = LAMP3 = 0;
 172   1        while(1){
 173   2          DS1307_Read_Time(&hour, &minute, &second, &day, &date, &month, &year);
 174   2          Display_Time();
 175   2          if (!SET){
 176   3            Set_Time();
 177   3            Delay(200);
 178   3          }
C51 COMPILER V9.60.7.0   DO_AN_I                                                           06/12/2025 19:42:24 PAGE 4   

 179   2          if (!ON){
 180   3            LAMP1 = LAMP2 = LAMP3 = 1;
 181   3          }else if (!OFF){
 182   3            LAMP1 = LAMP2 = LAMP3 = 0;
 183   3          }else{
 184   3            if ((7 <= hour)&&(hour < 17)){
 185   4              LAMP1 = LAMP2 = LAMP3 = 0;
 186   4            }else{
 187   4              if (LAMP1 && LAMP2 && LAMP3){
 188   5                LAMP1 = LAMP2 = LAMP3 = 0;
 189   5              }
 190   4              if (!PIR1){
 191   5                LAMP1 = 1;
 192   5                l2 = 1;
 193   5                LAMP3 = 0;
 194   5              }
 195   4              if (!PIR2){
 196   5                LAMP1 = 0;
 197   5                l2 = 1;
 198   5                LAMP3 = 1;
 199   5              }
 200   4              if (l2){
 201   5                if (!LAMP2){
 202   6                  Delay_Lamp();
 203   6                  LAMP2 = 1;
 204   6                }
 205   5              }
 206   4              m = 20;
 207   4              while (PIR1 & PIR2 && m){
 208   5                for (n = 0; n < 12500; n++);
 209   5                DS1307_Read_Time(&hour, &minute, &second, &day, &date, &month, &year);
 210   5                Display_Time();
 211   5                if (!ON || !OFF){
 212   6                  break;
 213   6                }
 214   5                m--;
 215   5              }
 216   4              if (!m){
 217   5                l2 = LAMP2 = 0;
 218   5                if (LAMP1){
 219   6                  Delay_Lamp();
 220   6                  LAMP1 = 0;
 221   6                }
 222   5                if (LAMP3){
 223   6                  Delay_Lamp();
 224   6                  LAMP3 = 0;
 225   6                }
 226   5              }
 227   4            }
 228   3          }
 229   2        }
 230   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1468    ----
   CONSTANT SIZE    =     15    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.7.0   DO_AN_I                                                           06/12/2025 19:42:24 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
